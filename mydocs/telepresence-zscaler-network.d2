# Telepresence + Zscaler Zero Trust Network Architecture

direction: right

# Define styles for keynote presentation
vars: {
  d2-config: {
    layout-engine: elk
    pad: 40
  }
}

# Title
title: |md
  # Telepresence + Zscaler Zero Trust Network
  ## Step-by-Step Traffic Flow
| {style: {font-size: 28}}

# Step 1: Developer Workstation
developer: {
  shape: rectangle
  label: "Step 1: Developer Workstation"
  style: {
    fill: "#F8F9FA"
    stroke: "#C8C8CC"
    stroke-width: 3
    border-radius: 20
    font-size: 22
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  browser: Browser {
    shape: rectangle
    style: {
      fill: "#FFFFFF"
      stroke: "#E5E5EA"
      stroke-width: 2
      border-radius: 12
      font-size: 16
      shadow: true
    }
  }
  
  telepresence: Telepresence\nClient {
    shape: package
    style: {
      fill: "#E4F5E9"
      stroke: "#34C759"
      stroke-width: 2
      border-radius: 12
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
  
  kubectl: kubectl\nCLI {
    shape: rectangle
    style: {
      fill: "#DDEEFE"
      stroke: "#0A84FF"
      stroke-width: 2
      border-radius: 12
      font-size: 16
      shadow: true
    }
  }
  
  zscaler: Zscaler\nClient {
    shape: package
    style: {
      fill: "#FFF3E0"
      stroke: "#FF9500"
      stroke-width: 2
      border-radius: 12
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
}

# Step 2: DNS Resolution
dns_resolution: {
  shape: rectangle
  label: "Step 2: DNS Resolution"
  style: {
    fill: "#FAFAFA"
    stroke: "#8E8E93"
    stroke-width: 3
    border-radius: 20
    font-size: 22
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  telepresence_dns: Telepresence DNS\n127.0.0.1:53 {
    shape: cylinder
    style: {
      fill: "#E4F5E9"
      stroke: "#34C759"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      shadow: true
    }
  }
  
  cluster_domains: *.cluster.local\n*.svc {
    shape: text
    style: {
      font-size: 14
      font-color: "#34C759"
      italic: true
    }
  }
  
  public_dns: Public DNS\nvia Zscaler {
    shape: cylinder
    style: {
      fill: "#FFF3E0"
      stroke: "#FF9500"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      shadow: true
    }
  }
  
  public_domains: *.com, *.io\n*.net, *.org {
    shape: text
    style: {
      font-size: 14
      font-color: "#FF9500"
      italic: true
    }
  }
}

# Step 3: Zscaler Security Layer
zscaler_security: {
  shape: rectangle
  label: "Step 3: Zscaler Security"
  style: {
    fill: "#FFF8E1"
    stroke: "#FF9500"
    stroke-width: 3
    border-radius: 20
    font-size: 22
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  zpa_service: ZPA\nZero Trust Access {
    shape: hexagon
    style: {
      fill: "#FFFFFF"
      stroke: "#FF9500"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
  
  zia_service: ZIA\nWeb Filtering {
    shape: hexagon
    style: {
      fill: "#FFFFFF"
      stroke: "#FF9500"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
  
  identity: Microsoft\nEntra ID {
    shape: cylinder
    style: {
      fill: "#0078D4"
      stroke: "#0078D4"
      font-size: 16
      font-color: "#FFFFFF"
      bold: true
      shadow: true
    }
  }
}

# Step 4: Kubernetes Cluster
k8s_cluster: {
  shape: rectangle
  label: "Step 4: Kubernetes Cluster"
  style: {
    fill: "#E3F2FD"
    stroke: "#326CE5"
    stroke-width: 3
    border-radius: 20
    font-size: 22
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  api_server: API Server\n192.168.122.27:6443 {
    shape: hexagon
    style: {
      fill: "#FFFFFF"
      stroke: "#326CE5"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
  
  traffic_manager: Telepresence\nTraffic Manager {
    shape: rectangle
    style: {
      fill: "#FFFFFF"
      stroke: "#34C759"
      stroke-width: 2
      border-radius: 12
      font-size: 16
      font-color: "#1D1D1F"
      shadow: true
    }
  }
  
  observable: Observable\nFramework {
    shape: circle
    style: {
      fill: "#FFFFFF"
      stroke: "#326CE5"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      bold: true
      shadow: true
    }
  }
}

# Step 5: Internet & Applications
internet_apps: {
  shape: rectangle
  label: "Step 5: Internet & Apps"
  style: {
    fill: "#F8F9FA"
    stroke: "#8E8E93"
    stroke-width: 3
    border-radius: 20
    font-size: 22
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  internet: Internet\nResources {
    shape: cloud
    style: {
      fill: "#FFFFFF"
      stroke: "#8E8E93"
      stroke-width: 2
      font-size: 16
      font-color: "#1D1D1F"
      shadow: true
    }
  }
  
  dashboard: Live Dashboard\nlocalhost:3000 {
    shape: rectangle
    style: {
      fill: "#34C759"
      stroke: "#34C759"
      font-size: 16
      font-color: "#FFFFFF"
      bold: true
      border-radius: 12
      shadow: true
    }
  }
}

# Step-by-Step Flow Connections

# Step 1 → Step 2: DNS Resolution
developer.telepresence -> dns_resolution.telepresence_dns: "1. Cluster DNS\n*.cluster.local" {
  style: {
    stroke: "#34C759"
    stroke-width: 4
    font-size: 14
    font-color: "#34C759"
    bold: true
  }
}

developer.zscaler -> dns_resolution.public_dns: "2. Public DNS\nvia Zscaler" {
  style: {
    stroke: "#FF9500"
    stroke-width: 4
    font-size: 14
    font-color: "#FF9500"
    bold: true
  }
}

# Step 2 → Step 3: Security Processing
dns_resolution.public_dns -> zscaler_security.zia_service: "3. Web Filtering" {
  style: {
    stroke: "#FF9500"
    stroke-width: 4
    font-size: 14
    font-color: "#FF9500"
    bold: true
  }
}

zscaler_security.identity -> zscaler_security.zpa_service: "4. Identity\nVerification" {
  style: {
    stroke: "#0078D4"
    stroke-width: 3
    font-size: 14
    font-color: "#0078D4"
    stroke-dash: 3
  }
}

# Step 3 → Step 4: Kubernetes Access
developer.kubectl -> k8s_cluster.api_server: "5. Direct K8s\nAPI Access" {
  style: {
    stroke: "#0A84FF"
    stroke-width: 4
    font-size: 14
    font-color: "#0A84FF"
    bold: true
  }
}

developer.telepresence -> k8s_cluster.traffic_manager: "6. Telepresence\nConnection" {
  style: {
    stroke: "#34C759"
    stroke-width: 4
    font-size: 14
    font-color: "#34C759"
    bold: true
  }
}

# Step 4 → Step 5: Live Applications
k8s_cluster.traffic_manager -> k8s_cluster.observable: "7. Traffic\nIntercept" {
  style: {
    stroke: "#34C759"
    stroke-width: 3
    font-size: 14
    stroke-dash: 3
  }
}

k8s_cluster.observable -> internet_apps.dashboard: "8. Live Dashboard\nAccess" {
  style: {
    stroke: "#34C759"
    stroke-width: 4
    font-size: 14
    font-color: "#34C759"
    bold: true
  }
}

zscaler_security.zia_service -> internet_apps.internet: "9. Filtered\nInternet" {
  style: {
    stroke: "#FF9500"
    stroke-width: 4
    font-size: 14
    font-color: "#FF9500"
    bold: true
  }
}

# Configuration Summary
config_summary: {
  shape: text
  label: "Key Configuration Points"
  style: {
    fill: "#F5F5F7"
    stroke: "#D1D1D6"
    stroke-width: 2
    border-radius: 16
    font-size: 18
    font-color: "#1D1D1F"
    bold: true
    shadow: true
  }
  
  details: |md
    **🔧 Zscaler Bypass Rules:**
    • DNS: 127.0.0.1:53 (Telepresence)
    • Networks: 10.43.0.0/16, 10.42.0.0/24
    • API Server: 192.168.122.27/32
    
    **🌐 DNS Routing:**
    • *.cluster.local → Telepresence DNS
    • *.com, *.io, *.net → Zscaler ZIA
    
    **🔒 Security Flow:**
    • Internet traffic → Zscaler filtering
    • K8s access → Direct connection
    • Identity → Microsoft Entra ID
  | {style: {font-size: 14}}
}

# Flow indicators for presentation
flow_title: {
  shape: text
  label: "Traffic Flow: Developer → DNS → Security → Kubernetes → Applications"
  style: {
    font-size: 20
    font-color: "#007AFF"
    bold: true
  }
}